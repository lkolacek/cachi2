
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../bundler/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Usage - Hermeto</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Hermeto" class="md-header__button md-logo" aria-label="Hermeto" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hermeto
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Usage
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/hermetoproject/hermeto" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hermetoproject/hermeto
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Hermeto" class="md-nav__button md-logo" aria-label="Hermeto" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Hermeto
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hermetoproject/hermeto" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hermetoproject/hermeto
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-process" class="md-nav__link">
    <span class="md-ellipsis">
      General Process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-sboms" class="md-nav__link">
    <span class="md-ellipsis">
      Merge SBOMs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-artifact-with-the-pre-fetched-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Building the Artifact with the Pre-fetched dependencies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building the Artifact with the Pre-fetched dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write-the-dockerfile-or-containerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Write the Dockerfile (or Containerfile)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Build the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-go-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Go modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: Go modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables_1" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files_1" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-the-dockerfile-or-containerfile_1" class="md-nav__link">
    <span class="md-ellipsis">
      Write the Dockerfile (or Containerfile)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-container_1" class="md-nav__link">
    <span class="md-ellipsis">
      Build the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Example: pip
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: pip">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-base-image-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Build the base image (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (pip)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Example: npm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: npm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (npm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables (npm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files (npm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (npm)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Example: yarn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: yarn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (yarn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables (yarn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files (yarn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (yarn)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-generic-fetcher" class="md-nav__link">
    <span class="md-ellipsis">
      Example: generic fetcher
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: generic fetcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-generic-fetcher" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (generic fetcher)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-generic-fetcher" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (generic fetcher)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Package managers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Package managers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bundler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bundler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cargo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cargo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    generic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gomod/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gomod
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../npm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    npm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pip
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yarn_classic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    yarn classic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yarn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    yarn berry
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-process" class="md-nav__link">
    <span class="md-ellipsis">
      General Process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-sboms" class="md-nav__link">
    <span class="md-ellipsis">
      Merge SBOMs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-artifact-with-the-pre-fetched-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Building the Artifact with the Pre-fetched dependencies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building the Artifact with the Pre-fetched dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write-the-dockerfile-or-containerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Write the Dockerfile (or Containerfile)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Build the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-go-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Go modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: Go modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables_1" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files_1" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-the-dockerfile-or-containerfile_1" class="md-nav__link">
    <span class="md-ellipsis">
      Write the Dockerfile (or Containerfile)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-container_1" class="md-nav__link">
    <span class="md-ellipsis">
      Build the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Example: pip
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: pip">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-base-image-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Build the base image (pip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (pip)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Example: npm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: npm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (npm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables (npm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files (npm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-npm" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (npm)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Example: yarn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: yarn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (yarn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-environment-variables-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Generate environment variables (yarn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-project-files-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Inject project files (yarn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-yarn" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (yarn)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-generic-fetcher" class="md-nav__link">
    <span class="md-ellipsis">
      Example: generic fetcher
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example: generic fetcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-fetch-dependencies-generic-fetcher" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-fetch dependencies (generic fetcher)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-application-image-generic-fetcher" class="md-nav__link">
    <span class="md-ellipsis">
      Build the application image (generic fetcher)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/hermetoproject/hermeto/edit/main/docs/usage.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/hermetoproject/hermeto/raw/main/docs/usage.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h1>
<p>This document is split into two general sections. The first goes through the general process of pre-fetching
dependencies and injecting relevant configuration and content for building an application in a hermetic environment.
The second section goes through each of these steps for the supported package managers.</p>
<ul>
<li><a href="#general-process">General Process</a></li>
<li><a href="#pre-fetch-dependencies">pre-fetch dependencies</a></li>
<li><a href="#generate-environment-variables">generate environment variables</a></li>
<li><a href="#inject-project-files">inject project files</a></li>
<li><a href="#merge-sboms">merge SBOMs</a></li>
<li><a href="#building-the-artifact-with-the-pre-fetched-dependencies">building the artifact</a><ul>
<li>set the environment variables (<a href="#write-the-dockerfile-or-containerfile">Containerfile example</a>)</li>
<li>run the build (<a href="#build-the-container">container build example</a>)</li>
</ul>
</li>
<li><a href="#usage-examples">Usage Examples</a></li>
<li><a href="#example-go-modules">Example with Go modules</a></li>
<li><a href="#example-pip">Example with pip</a></li>
<li><a href="#example-npm">Example with npm</a></li>
<li><a href="#example-yarn">Example with yarn</a></li>
<li><a href="#example-generic-fetcher">Example with generic fetcher</a></li>
</ul>
<h2 id="general-process">General Process<a class="headerlink" href="#general-process" title="Permanent link">&para;</a></h2>
<p>A hermetic build environment is one that is fully encapsulated and isolated from outside influences. When a build is
run on a build platform, this encapsulation can guarantee that the platform has a complete picture of all
dependencies needed for the build. One class of hermetic build implementations is to restrict external network access
during the build itself, requiring that all dependencies are declared and pre-fetched before the build occurs.</p>
<p>In order to support this class of hermetic builds, not only does Hermeto need to pre-fetch the dependencies, but some
build flows will need additional changes (i.e. leveraging defined <a href="#generate-environment-variables">environment variables</a>
or using Hermeto to <a href="#inject-project-files">inject project files</a>).</p>
<p>Hermeto relies on git metadata when processing sources, it expects sources to
be a valid git repository with "origin" remote defined. This is paramount
for successful execution. If for some reason you don't have a git repository,
e.g. you're trying to use Hermeto on an unpacked tarball, you may also get
acceptable results by forcefully creating a git repository from it first.
Make sure to set the remote as well.</p>
<details>
  <summary><i>Workaround to create a local-only git repository</i></summary>

  ```shell
  git init && git add -A && git commit -m "initial commit" && \
  git remote add origin https://github.com/someorg/somerepo
  ```
  **WARNING!** This is not a substitute for having a proper repository and should be used
  only for testing!
</details>

<p>Note however, that this is only good for smoke testing a scenario and there are
no guarantees for any results without proper and correct git metadata, e.g. git tags.</p>
<h3 id="pre-fetch-dependencies">Pre-fetch dependencies<a class="headerlink" href="#pre-fetch-dependencies" title="Permanent link">&para;</a></h3>
<p>The first step in creating hermetic builds is to fetch the dependencies for one of the supported package managers.</p>
<pre><code class="language-shell">hermeto fetch-deps \
  --source ./foo \
  --output ./hermeto-output \
  --sbom-output-type cyclonedx \
  '{&quot;path&quot;: &quot;.&quot;, &quot;type&quot;: &quot;&lt;supported package manager&gt;&quot;}'
</code></pre>
<ul>
<li><code>--source</code>           - the path to a <em>git repository</em> on the local disk <code>[default: .]</code></li>
<li><code>--output</code>           - the path to the directory where Hermeto will write all output <code>[default: ./hermeto-output]</code></li>
<li><code>--sbom-output-type</code> - the format of generated SBOM, supported values are <code>cyclonedx</code> (outputs <a href="https://cyclonedx.org/docs/1.4/json">CycloneDX v1.4</a>) and <code>spdx</code> (outputs <a href="https://spdx.github.io/spdx-spec/v2.3/">SPDX v2.3</a>). <code>[default: cyclonedx]</code></li>
<li><code>{JSON}</code>             - specifies a <em>package</em> (a directory) within the repository to process</li>
</ul>
<p>Note that Hermeto does not auto-detect which package managers your project uses. You need to tell Hermeto what to process
when calling fetch-deps. In the example above, the package path is located at the root of the foo repo,
hence the relative path is <code>.</code>.</p>
<p>The main parameter (PKG) can handle different types of definitions:</p>
<ul>
<li>simple: <code>&lt;package manager&gt;</code>, same as <code>{"path": ".", "type": "&lt;package manager&gt;"}</code></li>
<li>JSON object: <code>{"path": "subpath/to/other/module", "type": "&lt;package manager&gt;"}</code></li>
<li>JSON array: <code>[{"path": ".", "type": "&lt;package manager&gt;"}, {"path": "subpath/to/other/module", "type": "&lt;package manager&gt;"}]</code></li>
<li>JSON object with flags:
<code>{"packages": [{"path": ".", "type": "&lt;package manager&gt;"}], "flags": ["cgo-disable"]}</code></li>
</ul>
<p>See also <code>hermeto fetch-deps --help</code>.</p>
<p>Using the JSON array object, multiple package managers can be used to resolve dependencies in the same repository.</p>
<p><em>⚠ While Hermeto does not intentionally modify the source repository unless the output and source paths are the same,
some package managers may add missing data like checksums as dependency data is resolved. If this occurs from a clean
git tree then the tree has the possibility to become dirty.</em></p>
<h3 id="generate-environment-variables">Generate environment variables<a class="headerlink" href="#generate-environment-variables" title="Permanent link">&para;</a></h3>
<p>Once the dependencies have been cached, the build process needs to be made aware of the dependencies. Some package
managers need to be informed of cache customizations by environment variables.</p>
<p>In order to simplify this process, Hermeto provides a helper command to generate the environment variables in an
easy-to-use format. The example above uses the "env" format which generates a simple shell script that <code>export</code>s
the required variables (properly shell quoted when necessary). You can <code>source</code> this file to set the variables.</p>
<pre><code class="language-shell">hermeto generate-env ./hermeto-output -o ./hermeto.env --for-output-dir /tmp/hermeto-output
</code></pre>
<ul>
<li><code>-o</code> - the output path for the generated environment file</li>
</ul>
<p>Don't worry about the <code>--for-output-dir</code> option yet - and about the fact that the directory does not exist - it has to
do with the target path where we will mount the output directory <a href="#build-the-container">during the build</a>.</p>
<p>See also <code>hermeto generate-env --help</code>.</p>
<h3 id="inject-project-files">Inject project files<a class="headerlink" href="#inject-project-files" title="Permanent link">&para;</a></h3>
<p>While some package managers only need an environment file to be informed of the cache locations, others may need to
create a configuration file or edit a lockfile (or some other file in your project directory).</p>
<p>Before starting your build, call <code>hermeto inject-files</code> to automatically make the necessary changes in your repository
(based on data in the fetch-deps output directory). Please do not change the absolute path to the repo between the calls
to fetch-deps and inject-files; if it's not at the same path, the inject-files command won't find it.</p>
<pre><code class="language-shell">hermeto inject-files ./hermeto-output --for-output-dir /tmp/hermeto-output
</code></pre>
<p>The <code>--for-output-dir</code> option has the same meaning as the one used when generating environment variables.</p>
<p><em>⚠ Hermeto may overwrite existing files. Please make sure you have no un-committed changes (that you are not prepared to
lose) when calling inject-files.</em></p>
<p><em>⚠ Hermeto may change files if required by the package manager. This means that the git status will become dirty if
it was previously clean. If any scripting depends on the cleanliness of a git repository and you do not want to commit
the changes, the scripting should either be changed to handle the dirty status or the changes should be temporarily
stashed by wrapping in <code>git stash &amp;&amp; &lt;command&gt; &amp;&amp; git stash pop</code> according to the suitability of the context.</em></p>
<h3 id="merge-sboms">Merge SBOMs<a class="headerlink" href="#merge-sboms" title="Permanent link">&para;</a></h3>
<p>Sometimes it might be necessary to merge two or more SBOMs. This could be done with <code>hermeto merge-sboms</code>:</p>
<pre><code class="language-shell">hermeto merge-sboms &lt;hermeto_sbom_1.json&gt; ... &lt;hermeto_sbom_n.json&gt;
</code></pre>
<p>The subcommand expects at least two SBOMs, all produced by Hermeto, and will exit with error
otherwise. The reason for this is that Hermeto supports a
<a href="https://github.com/hermetoproject/hermeto/blob/main/hermeto/core/models/sbom.py#L7-L13">limited set</a>
of component <a href="https://cyclonedx.org/docs/1.4/json/#components_items_properties">properties</a>,
and it validates that no other properties exist in the SBOM. By default the result of a merge
will be printed to stdout. To save it to a file use <code>-o</code> option:</p>
<pre><code class="language-shell">hermeto merge-sboms &lt;hermeto_sbom_1.json&gt; ... &lt;hermeto_sbom_n.json&gt; -o &lt;merged_sbom.json&gt;
</code></pre>
<h3 id="building-the-artifact-with-the-pre-fetched-dependencies">Building the Artifact with the Pre-fetched dependencies<a class="headerlink" href="#building-the-artifact-with-the-pre-fetched-dependencies" title="Permanent link">&para;</a></h3>
<p>After the pre-fetch and the above steps to inform the package manager(s) of the cache have been completed, it all
needs to be wired up into a build. The primary use case for building these is within a Dockerfile or Containerfile
but the same principles can be applied to other build strategies.</p>
<h4 id="write-the-dockerfile-or-containerfile">Write the Dockerfile (or Containerfile)<a class="headerlink" href="#write-the-dockerfile-or-containerfile" title="Permanent link">&para;</a></h4>
<p>Now that we have pre-fetched our dependencies and enabled package manager configuration to point to them, we now need
to ensure that the build process (i.e. a Dockerfile or Containerfile for a container build) is properly written to
build in a network isolated mode. All injected files are changed in the source itself, so they will be present in the
build context for the Containerfile. The environment variables added to the <code>hermeto.env</code> file, however, will not be
pulled into the build process without a specific action to <code>source</code> the generated file.</p>
<p>Outside of this additional <code>source</code> directive in any relevant <code>RUN</code> command, the rest of a container build can
remain unchanged.</p>
<pre><code class="language-dockerfile">FROM golang:1.19.2-alpine3.16 AS build

COPY ./foo /src/foo
WORKDIR /src/foo

RUN source /tmp/hermeto.env &amp;&amp; \
    make build

FROM registry.access.redhat.com/ubi9/ubi-minimal:9.0.0

COPY --from=build /foo /usr/bin/foo
</code></pre>
<p><em>⚠ The <code>source</code>d environment variables do not persist to the next RUN instruction. The sourcing of the file and the
package manager command(s) need to be in the same instruction. If the build needs more than one command and you would
like to split them into separate RUN instructions, <code>source</code> the environment file in each one.</em></p>
<pre><code class="language-dockerfile">RUN source /tmp/hermeto.env &amp;&amp; \
    go build -o /foo cmd/foo &amp;&amp; \
    go build -o /bar cmd/bar

# or, if preferrable
RUN source /tmp/hermeto.env &amp;&amp; go build -o /foo cmd/foo
RUN source /tmp/hermeto.env &amp;&amp; go build -o /bar cmd/bar
</code></pre>
<h4 id="build-the-container">Build the container<a class="headerlink" href="#build-the-container" title="Permanent link">&para;</a></h4>
<p>Now that the Dockerfile or Container file is configured, the next step is to build the container itself. Since
more than just the source code context is needed to build the container, we also need to make sure that there
are appropriate volumes mounted for the Hermeto output as well as the Hermeto environment variable that is being
<code>source</code>d within the build. Since all dependencies are cached, we can confidently restrict the network from the
container build as well!</p>
<pre><code class="language-shell">podman build . \
  --volume &quot;$(realpath ./hermeto-output)&quot;:/tmp/hermeto-output:Z \
  --volume &quot;$(realpath ./hermeto.env)&quot;:/tmp/hermeto.env:Z \
  --network none \
  --tag foo

# test that it worked
podman run --rm -ti foo
</code></pre>
<p>We use the <code>--volume</code> option to mount Hermeto resources into the container build - the output directory at
/tmp/hermeto-output/ and the environment file at /tmp/hermeto.env.</p>
<p>The path where the output directory gets mounted is important. Some environment variables or project files may use
absolute paths to content in the output directory; if the directory is not at the expected path, the paths will be
wrong. Remember the <code>--for-output-dir</code> option used when <a href="#generate-environment-variables">generating the env file</a>
and <a href="#inject-project-files">injecting the project files</a>? The absolute path to ./hermeto-output on your machine is
(probably) not /tmp/hermeto-output. That is why we had to tell the generate-env command what the path inside the
container is eventually going to be.</p>
<p>In order to run the build with network isolation, use the <code>--network=none</code> option. Note that this option only works
if your podman/buildah version contains the fix for <a href="https://github.com/containers/buildah/issues/4227">buildah#4227</a>
(buildah &gt;= 1.28). In older versions, a workaround could be to manually create an internal network (but you'll need root
privileges): <code>sudo podman network create --internal isolated-network; sudo podman build --network isolated-network ...</code>.</p>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">&para;</a></h2>
<p>Now that we are familiar with the overall process, we will go through an example for each of the supported package
managers.</p>
<h3 id="example-go-modules">Example: Go modules<a class="headerlink" href="#example-go-modules" title="Permanent link">&para;</a></h3>
<p>Let's show Hermeto usage by building the glorious <a href="https://github.com/junegunn/fzf">fzf</a> CLI tool hermetically. To follow
along, clone the repository to your local disk.</p>
<pre><code class="language-shell">git clone https://github.com/junegunn/fzf --branch=0.34.0
</code></pre>
<h4 id="pre-fetch-dependencies_1">Pre-fetch dependencies<a class="headerlink" href="#pre-fetch-dependencies_1" title="Permanent link">&para;</a></h4>
<p>In order to pre-fetch the dependencies, we will pass the source and output directories as well as the path for the
<code>gomod</code> package manager to be able to find the <code>go.mod</code> file.</p>
<p>See <a href="../gomod/">the gomod documentation</a> for more details about running Hermeto for pre-fetching gomod dependencies.</p>
<pre><code class="language-shell">hermeto fetch-deps \
  --source ./fzf \
  --output ./hermeto-output \
  '{&quot;path&quot;: &quot;.&quot;, &quot;type&quot;: &quot;gomod&quot;}'
</code></pre>
<h4 id="generate-environment-variables_1">Generate environment variables<a class="headerlink" href="#generate-environment-variables_1" title="Permanent link">&para;</a></h4>
<p>Next, we need to generate the environment file so that the <code>go build</code> command can find the cached dependencies</p>
<pre><code class="language-shell">hermeto generate-env ./hermeto-output -o ./hermeto.env --for-output-dir /tmp/hermeto-output
</code></pre>
<p>We can see the variables needed by the compiler:</p>
<pre><code class="language-shell">$ cat hermeto.env
export GOCACHE=/tmp/hermeto-output/deps/gomod
export GOMODCACHE=/tmp/hermeto-output/deps/gomod/pkg/mod
export GOPATH=/tmp/hermeto-output/deps/gomod
</code></pre>
<h4 id="inject-project-files_1">Inject project files<a class="headerlink" href="#inject-project-files_1" title="Permanent link">&para;</a></h4>
<p>While the <code>gomod</code> package manager does not <em>currently</em> need to modify any content in the source directory to inject the
dependencies, the <code>inject-files</code> command should be run to ensure that the operation is performed if this step
becomes a requirement in the future.</p>
<pre><code class="language-shell">hermeto inject-files ./hermeto-output --for-output-dir /tmp/hermeto-output
</code></pre>
<h4 id="write-the-dockerfile-or-containerfile_1">Write the Dockerfile (or Containerfile)<a class="headerlink" href="#write-the-dockerfile-or-containerfile_1" title="Permanent link">&para;</a></h4>
<p>As mentioned in the steps above, the only change that needs to be made in the Dockerfile or Containerfile is to
source the environment file before building the binary.</p>
<pre><code class="language-dockerfile">FROM golang:1.19.2-alpine3.16 AS build

COPY ./fzf /src/fzf
WORKDIR /src/fzf

RUN source /tmp/hermeto.env &amp;&amp; \
    go build -o /fzf

FROM registry.access.redhat.com/ubi9/ubi-minimal:9.0.0

COPY --from=build /fzf /usr/bin/fzf

CMD ls | fzf
</code></pre>
<h4 id="build-the-container_1">Build the container<a class="headerlink" href="#build-the-container_1" title="Permanent link">&para;</a></h4>
<p>Finally, we can build and test the container to ensure that we have successfully built the binary.</p>
<pre><code class="language-shell">podman build . \
  --volume &quot;$(realpath ./hermeto-output)&quot;:/tmp/hermeto-output:Z \
  --volume &quot;$(realpath ./hermeto.env)&quot;:/tmp/hermeto.env:Z \
  --network none \
  --tag fzf

# test that it worked
podman run --rm -ti fzf
</code></pre>
<h3 id="example-pip">Example: pip<a class="headerlink" href="#example-pip" title="Permanent link">&para;</a></h3>
<p>Let's build <a href="https://github.com/containerbuildsystem/atomic-reactor">atomic-reactor</a>. Atomic-reactor already builds
with Cachito (Hermeto's spiritual ancestor), which makes it a rare example of a Python project that meets Hermeto's
requirements out of the box (see <a href="../pip/">pip.md</a> for more context).</p>
<p>Get the repo if you want to try for yourself:</p>
<pre><code class="language-shell">git clone https://github.com/containerbuildsystem/atomic-reactor --branch=4.4.0
</code></pre>
<h4 id="pre-fetch-dependencies-pip">Pre-fetch dependencies (pip)<a class="headerlink" href="#pre-fetch-dependencies-pip" title="Permanent link">&para;</a></h4>
<p>The steps for pre-fetching the dependencies is similar to before, but this time we will use the <code>pip</code> package
manager type. The default behavior path of <code>.</code> is assumed. Additional parameters are also configured to point
Hermeto at the various requirements files that are needed to fully resolve dependencies.</p>
<p>See <a href="../pip/">the pip documentation</a> for more details about running Hermeto for pre-fetching pip dependencies.</p>
<pre><code class="language-shell">hermeto fetch-deps --source ./atomic-reactor '{
  &quot;type&quot;: &quot;pip&quot;,
  &quot;requirements_files&quot;: [&quot;requirements.txt&quot;],
  &quot;requirements_build_files&quot;: [&quot;requirements-build.txt&quot;, &quot;requirements-pip.txt&quot;]
}'
</code></pre>
<h4 id="generate-environment-variables-pip">Generate environment variables (pip)<a class="headerlink" href="#generate-environment-variables-pip" title="Permanent link">&para;</a></h4>
<p>Next, we need to generate the environment file so that the <code>pip install</code> command can find the cached dependencies</p>
<pre><code class="language-shell">hermeto generate-env ./hermeto-output -o ./hermeto.env --for-output-dir /tmp/hermeto-output
</code></pre>
<p>We can see the variables needed by the package manager:</p>
<pre><code class="language-shell">$ cat hermeto.env
export PIP_FIND_LINKS=/tmp/hermeto-output/deps/pip
export PIP_NO_INDEX=true
</code></pre>
<h4 id="inject-project-files-pip">Inject project files (pip)<a class="headerlink" href="#inject-project-files-pip" title="Permanent link">&para;</a></h4>
<p>In order to be able to install pip dependencies in a hermetic environment, we need to perform the injection to
change the remote dependencies to instead point to the local file system.</p>
<pre><code class="language-shell">$ hermeto inject-files ./hermeto-output --for-output-dir /tmp/hermeto-output
2023-01-26 16:41:09,990 INFO Overwriting /tmp/test/atomic-reactor/requirements.txt
</code></pre>
<p>We can look at the <code>git diff</code> to see what the package remapping looks like. As an example,</p>
<pre><code class="language-diff">diff --git a/requirements.txt b/requirements.txt
-osbs-client @ git+https://github.com/containerbuildsystem/osbs-client@8d7d7fadff38c8367796e6ac0b3516b65483db24
-    # via -r requirements.in
+osbs-client @ file:///tmp/hermeto-output/deps/pip/github.com/containerbuildsystem/osbs-client/osbs-client-external-gitcommit-8d7d7fadff38c8367796e6ac0b3516b65483db24.tar.gz
</code></pre>
<p><em>⚠ This is only needed for <a href="../pip/#external-dependencies">external dependencies</a>. If all dependencies come from PyPi,
Hermeto will not replace anything.</em></p>
<h4 id="build-the-base-image-pip">Build the base image (pip)<a class="headerlink" href="#build-the-base-image-pip" title="Permanent link">&para;</a></h4>
<p>For this example, we will split the build into two parts - a base image and the final application image. Since there
is no way to install RPMs in a hermetic environment, we will create the base image with its required "devel" libraries
from RPMs in one image and then use that image for our hermetic python build.</p>
<p>If your project doesn't need to compile as many C packages as atomic-reactor, you may be able to find a base image that
already contains everything you need.</p>
<p>Containerfile.baseimage:</p>
<pre><code class="language-Dockerfile">FROM quay.io/centos/centos:stream8

# python3.8 runtime, C build dependencies
RUN dnf -y install \
        python38 \
        python38-pip \
        python38-devel \
        gcc \
        make \
        libffi-devel \
        krb5-devel \
        cairo-devel \
        cairo-gobject-devel \
        gobject-introspection-devel \
        openssl-devel &amp;&amp; \
    dnf clean all
</code></pre>
<p>This container build might be what we are familiar with already as we are not using Hermeto or enforcing network
isolation.</p>
<pre><code class="language-shell">podman build . -f Containerfile.baseimage --tag atomic-reactor-base-image:latest
</code></pre>
<h4 id="build-the-application-image-pip">Build the application image (pip)<a class="headerlink" href="#build-the-application-image-pip" title="Permanent link">&para;</a></h4>
<p>We will base the final application image on our custom base image. The base image build installed all the RPMs we will
need, so the final phase can use network isolation again 🎉. In order to support the network isolated build, we need
to remember to <code>source</code> the environment file in the step that executes <code>pip install</code>. Because <code>osbs-client</code> comes from
GitHub, the source code in <code>/src/atomic-reactor</code> has also been changed so that the dependencies are pointing to the cached
versions.</p>
<p>Containerfile:</p>
<pre><code class="language-Dockerfile">FROM atomic-reactor-base-image:latest

COPY atomic-reactor/ /src/atomic-reactor
WORKDIR /src/atomic-reactor

# Need to source the hermeto.env file to set the environment variables
# (in the same RUN instruction as the pip commands)
RUN source /tmp/hermeto.env &amp;&amp; \
    # We're using network isolation =&gt; cannot build the cryptography package with Rust
    # (it downloads Rust crates)
    export CRYPTOGRAPHY_DONT_BUILD_RUST=1 &amp;&amp; \
    python3.8 -m pip install -U pip &amp;&amp; \
    python3.8 -m pip install --use-pep517 -r requirements.txt &amp;&amp; \
    python3.8 -m pip install --use-pep517 .

CMD [&quot;python3.8&quot;, &quot;-m&quot;, &quot;atomic_reactor.cli.main&quot;, &quot;--help&quot;]
</code></pre>
<p>We can then build the image as before while mounting the required Hermeto data!</p>
<pre><code class="language-shell">podman build . \
  --volume &quot;$(realpath ./hermeto-output)&quot;:/tmp/hermeto-output:Z \
  --volume &quot;$(realpath ./hermeto.env)&quot;:/tmp/hermeto.env:Z \
  --network none \
  --tag atomic-reactor
</code></pre>
<h3 id="example-npm">Example: npm<a class="headerlink" href="#example-npm" title="Permanent link">&para;</a></h3>
<p>Let's build simple npm project <a href="https://github.com/cachito-testing/sample-nodejs-app">sample-nodejs-app</a>.
Get the repo if you want to try for yourself:</p>
<pre><code class="language-shell">git clone https://github.com/cachito-testing/sample-nodejs-app.git
</code></pre>
<h4 id="pre-fetch-dependencies-npm">Pre-fetch dependencies (npm)<a class="headerlink" href="#pre-fetch-dependencies-npm" title="Permanent link">&para;</a></h4>
<p>The steps for pre-fetching the dependencies is similar to before, but this time we will use the <code>npm</code> package
manager type. The default behavior path of <code>.</code> is assumed.</p>
<p>See <a href="../npm/">the npm documentation</a> for more details about running Hermeto for pre-fetching npm dependencies.</p>
<pre><code class="language-shell">hermeto fetch-deps --source ./sample-nodejs-app --output ./hermeto-output '{&quot;type&quot;: &quot;npm&quot;}'
</code></pre>
<h4 id="generate-environment-variables-npm">Generate environment variables (npm)<a class="headerlink" href="#generate-environment-variables-npm" title="Permanent link">&para;</a></h4>
<p>Next, we need to generate the environment file, so we can provide environment variables to the <code>npm install</code> command.</p>
<pre><code class="language-shell">hermeto generate-env ./hermeto-output -o ./hermeto.env --for-output-dir /tmp/hermeto-output
</code></pre>
<p>Currently, Hermeto does not require any environment variables for the npm package manager, but this might change in the future.</p>
<h4 id="inject-project-files-npm">Inject project files (npm)<a class="headerlink" href="#inject-project-files-npm" title="Permanent link">&para;</a></h4>
<p>In order to be able to install npm dependencies in a hermetic environment,
we need to perform the injection to change the remote dependencies to instead point to the local file system.</p>
<pre><code class="language-shell">hermeto inject-files ./hermeto-output --for-output-dir /tmp/hermeto-output
</code></pre>
<p>We can look at the <code>git diff</code> to see what the package remapping looks like. As an example,</p>
<pre><code class="language-diff">diff --git a/package-lock.json b/package-lock.json
-      &quot;resolved&quot;: &quot;https://registry.npmjs.org/accepts/-/accepts-1.3.8.tgz&quot;,
+      &quot;resolved&quot;: &quot;file:///tmp/hermeto-output/deps/npm/accepts-1.3.8.tgz&quot;,
</code></pre>
<h4 id="build-the-application-image-npm">Build the application image (npm)<a class="headerlink" href="#build-the-application-image-npm" title="Permanent link">&para;</a></h4>
<p>We will base the final application image on <code>node:18</code> base image.
The base image build has <code>npm</code> pre-installed, so the final phase can use network isolation 🎉.</p>
<pre><code class="language-Containerfile">FROM node:18

COPY sample-nodejs-app/ /src/sample-nodejs-app
WORKDIR /src/sample-nodejs-app

# Run npm install command and list installed packages
RUN . /tmp/hermeto.env &amp;&amp; npm i &amp;&amp; npm ls

EXPOSE 9000

CMD [&quot;node&quot;, &quot;index.js&quot;]
</code></pre>
<p>We can then build the image as before while mounting the required Hermeto data!</p>
<pre><code class="language-shell">podman build . \
  --volume &quot;$(realpath ./hermeto-output)&quot;:/tmp/hermeto-output:Z \
  --volume &quot;$(realpath ./hermeto.env)&quot;:/tmp/hermeto.env:Z \
  --network none \
  --tag sample-nodejs-app
</code></pre>
<h3 id="example-yarn">Example: yarn<a class="headerlink" href="#example-yarn" title="Permanent link">&para;</a></h3>
<p>For the Yarn example let's use the same sample Node.js
<a href="https://github.com/cachito-testing/sample-nodejs-app/tree/yarn">project</a>, but this time modified
to use Yarn as the package manager. Get the repo if you want to try for yourself:</p>
<pre><code class="language-shell">git clone -b yarn https://github.com/cachito-testing/sample-nodejs-app.git
</code></pre>
<h4 id="pre-fetch-dependencies-yarn">Pre-fetch dependencies (yarn)<a class="headerlink" href="#pre-fetch-dependencies-yarn" title="Permanent link">&para;</a></h4>
<p>The steps for pre-fetching the dependencies are very similar to the previous examples, this time
using the Yarn package manager. Like with the previous examples the default path for the package
we assume is <code>.</code>.</p>
<p>See <a href="../yarn/">the Yarn documentation</a> for more details about running Hermeto for pre-fetching yarn
dependencies.</p>
<pre><code class="language-shell">hermeto fetch-deps --source ./sample-yarn-app --output ./hermeto-output '{&quot;type&quot;: &quot;yarn&quot;}'
</code></pre>
<p>OR more simply (without the need of a JSON formatted argument) just </p>
<pre><code class="language-shell">hermeto fetch-deps --source ./sample-yarn-app --output ./hermeto-output yarn
</code></pre>
<h4 id="generate-environment-variables-yarn">Generate environment variables (yarn)<a class="headerlink" href="#generate-environment-variables-yarn" title="Permanent link">&para;</a></h4>
<p>There are a few environment variables we'll have to set for Yarn during the hermetic build, so we
need to generate an environment file.</p>
<pre><code class="language-shell">$ hermeto generate-env ./hermeto-output -o ./hermeto.env --for-output-dir /tmp/hermeto-output
$ cat ./hermeto.env
export YARN_ENABLE_GLOBAL_CACHE=false
export YARN_ENABLE_IMMUTABLE_CACHE=false
export YARN_ENABLE_MIRROR=true
export YARN_GLOBAL_FOLDER=/tmp/hermeto-output/deps/yarn
</code></pre>
<h4 id="inject-project-files-yarn">Inject project files (yarn)<a class="headerlink" href="#inject-project-files-yarn" title="Permanent link">&para;</a></h4>
<p>Like the <code>gomod</code> package manager Yarn does not <em>currently</em> need to modify any content in the source
directory for the cached dependencies to be used in a hermetic build, however that might change in
the future.</p>
<h4 id="build-the-application-image-yarn">Build the application image (yarn)<a class="headerlink" href="#build-the-application-image-yarn" title="Permanent link">&para;</a></h4>
<p>Yarn is installed using a Node.js tool called
<a href="https://nodejs.org/api/corepack.html#corepack">Corepack</a> which has been shipped by Node.js by
default since v16.9.0 and v14.19.0. Therefore, we'll use the <code>node:18</code> base image in our example
which definitely has Corepack and we can start using Yarn right away.</p>
<pre><code class="language-Containerfile">FROM node:18

COPY sample-yarn-app/ /src/sample-yarn-app
WORKDIR /src/sample-yarn-app

# Run yarn install command and list installed packages
RUN . /tmp/hermeto.env &amp;&amp; yarn install

EXPOSE 9000

CMD [&quot;yarn&quot;, &quot;run&quot;, &quot;start&quot;]
</code></pre>
<p>We can then build the image as before while mounting the required Hermeto data!</p>
<pre><code class="language-shell">podman build . \
  --volume &quot;$(realpath ./hermeto-output)&quot;:/tmp/hermeto-output:Z \
  --volume &quot;$(realpath ./hermeto.env)&quot;:/tmp/hermeto.env:Z \
  --network none \
  --tag sample-nodejs-app
</code></pre>
<h3 id="example-generic-fetcher">Example: generic fetcher<a class="headerlink" href="#example-generic-fetcher" title="Permanent link">&para;</a></h3>
<p>Generic fetcher is a package manager that can fetch arbitrary files. Let's build a sample container image that would be
inconvenient to build hermetically otherwise. This image will provide <a href="https://github.com/jeremylong/DependencyCheck">OWASP Dependency check</a>
tool, which is available to install from GitHub releases page. Get the repo if you want to try for yourself:</p>
<pre><code>git clone -b sample-app https://github.com/cachito-testing/cachi2-generic.git
</code></pre>
<h4 id="pre-fetch-dependencies-generic-fetcher">Pre-fetch dependencies (generic fetcher)<a class="headerlink" href="#pre-fetch-dependencies-generic-fetcher" title="Permanent link">&para;</a></h4>
<p>In order to retrieve the archive with the tool, either a <code>artifacts.lock.yaml</code> needs to be in the repository, or an absolute
path needs to be supplied in the JSON input, pointing to a lockfile. You can find a sample lockfile below. It is identical
to the one found in the <a href="https://github.com/cachito-testing/cachi2-generic/tree/sample-app">sample repository</a>.
A lockfile for the generic fetcher must contain a <code>metadata</code> header and a list of artifacts, where each artifact is
represented as a pair of URL and a checksum string in the format of <code>"algorithm:checksum"</code>. Optionally, you can also specify
an output <code>filename</code> for the artifact. If not specified, it will be derived from the url. </p>
<pre><code>---
metadata:
  version: &quot;1.0&quot;
artifacts:
  - download_url: &quot;https://github.com/jeremylong/DependencyCheck/releases/download/v11.1.0/dependency-check-11.1.0-release.zip&quot;
    checksum: &quot;sha256:c5b5b9e592682b700e17c28f489fe50644ef54370edeb2c53d18b70824de1e22&quot;
    filename: &quot;dependency-check.zip&quot;
</code></pre>
<p>As with other examples, the command to fetch dependencies is very similar. The default path
is assumed to be <code>.</code>.</p>
<pre><code>hermeto fetch-deps --source ./hermeto-generic --output ./hermeto-output generic
</code></pre>
<h4 id="build-the-application-image-generic-fetcher">Build the application image (generic fetcher)<a class="headerlink" href="#build-the-application-image-generic-fetcher" title="Permanent link">&para;</a></h4>
<p>We'll use the <code>ibmjava:11-jdk</code> as base image because it already has java pre-installed.
During the build, the downloaded release will be extracted and modified to have execute rights.</p>
<pre><code class="language-Containerfile">FROM ibmjava:11-jdk

WORKDIR /tmp

# use jar to unzip file in order to avoid having to install more depependencies
RUN jar -xvf hermeto-output/deps/generic/dependency-check.zip

RUN chmod +x dependency-check/bin/dependency-check.sh

ENTRYPOINT [&quot;/tmp/dependency-check/bin/dependency-check.sh&quot;, &quot;--version&quot;]
</code></pre>
<p>We can then build the image as before while mounting the required Hermeto data.</p>
<pre><code>podman build . \
  --volume &quot;$(realpath ./hermeto-output)&quot;:/tmp/hermeto-output:Z \
  --network none \
  --tag sample-generic-app
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.tooltips", "navigation.sections", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>